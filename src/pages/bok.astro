---
import Layout from '@/layouts/Base.astro';
import HeroSection from '@/components/HeroSection.astro';
import PageSection from '@/components/PageSection.astro';
import Prose from '@/components/Prose.astro';
---

<Layout title="Håndbok" description="Kynds håndbok for ansatte">
  <HeroSection
    title="Kynds håndbok"
    preamble="Her kan du lese mer om oss og hvordan vi gjør ting. Det er bare å snoke i vei."
  />

  <!-- Mobile sticky navigation -->
  <nav class="mobile-nav" id="mobile-nav">
    <div
      class="mobile-nav-content"
      id="handbook-menu-toggle"
      tabindex="0"
      role="button"
      aria-label="Toggle handbook navigation menu"
      aria-expanded="false"
    >
      <span class="triangle-icon">▶</span>
      <h3 class="nav-title" id="current-section">Introduksjon</h3>

      <!-- Dropdown menu -->
      <div class="handbook-dropdown" id="handbook-dropdown">
        <ul class="nav-menu" id="nav-menu">
          <li><a href="#om-kynd" data-section="Om Kynd">Om Kynd</a></li>
          <li><a href="#lonn-og-goder" data-section="Lønn og goder">Lønn og goder</a></li>
          <li><a href="#arbeidsforhold" data-section="Arbeidsforhold">Arbeidsforhold</a></li>
          <li>
            <a href="#ferie-og-permisjon" data-section="Ferie og permisjon">Ferie og permisjon</a>
          </li>
          <li>
            <a href="#kompetanseutvikling" data-section="Kompetanseutvikling">Kompetanseutvikling</a
            >
          </li>
          <li>
            <a href="#miljo-og-barekraft" data-section="Miljø og bærekraft">Miljø og bærekraft</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="handbook-container">
    <!-- Desktop sidebar navigation -->
    <nav class="handbook-nav desktop-nav">
      <ul class="nav-menu">
        <li><a href="#om-kynd">Om Kynd</a></li>
        <li><a href="#lonn-og-goder">Lønn og goder</a></li>
        <li><a href="#arbeidsforhold">Arbeidsforhold</a></li>
        <li><a href="#ferie-og-permisjon">Ferie og permisjon</a></li>
        <li><a href="#kompetanseutvikling">Kompetanseutvikling</a></li>
        <li><a href="#miljo-og-barekraft">Miljø og bærekraft</a></li>
      </ul>
    </nav>

    <div class="handbook-content">
      <section id="om-kynd">
        <PageSection heading="Om Kynd">
          <Prose align="left">
            <p>
              Kynd er et konsulentbyrå innen fullstack softwareutvikling, organisasjonsdesign og
              smidig produkt-, team og endringsledelse. Vi ble stiftet i 2024 av tre amigos -
              Daniel, Frederik og Axel.
            </p>
            <p>
              Vi er et selskap laget av de ansatte, for de ansatte. Vi ønsker å lage verdens beste
              arbeidsplass, og det gjør vi ved å sette menneskene i fokus.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Grunnverdier</h3>
            <ul>
              <li>Åpenhet</li>
              <li>Samhold</li>
              <li>Enkelhet</li>
              <li>Dristighet</li>
              <li>Relasjonsorientering</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Kynd er et konsulentbyrå innen fullstack softwareutvikling, organisasjonsdesign og
              smidig produkt-, team og endringsledelse. Vi ble stiftet i 2024 av tre amigos -
              Daniel, Frederik og Axel.
            </p>
            <p>
              Vi er et selskap laget av de ansatte, for de ansatte. Vi ønsker å lage verdens beste
              arbeidsplass, og det gjør vi ved å sette menneskene i fokus.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Grunnverdier</h3>
            <ul>
              <li>Åpenhet</li>
              <li>Samhold</li>
              <li>Enkelhet</li>
              <li>Dristighet</li>
              <li>Relasjonsorientering</li>
            </ul>
          </Prose>
        </PageSection>
      </section>

      <section id="lonn-og-goder">
        <PageSection heading="Lønn og goder">
          <Prose align="left">
            <p>
              Vi har åpen lønn, som vil si at alle i selskapet vet hva de andre tjener. Du slipper
              også å forhandle på lønnen din.
            </p>
            <p>
              Vi oppjusterer lønnen din 1. januar hvert år basert på resultatet til Kynd. Vi passer
              på at lønna holder seg konkurransedyktig og tar også høyde for inflasjon.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Goder</h3>
            <ul>
              <li>Konkurransedyktig lønn</li>
              <li>Åpen økonomi</li>
              <li>Likeverdig eierskap</li>
              <li>Fleksible arbeidsforhold</li>
              <li>Kompetanseutvikling</li>
              <li>Moderne utstyr</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Vi har åpen lønn, som vil si at alle i selskapet vet hva de andre tjener. Du slipper
              også å forhandle på lønnen din.
            </p>
            <p>
              Vi oppjusterer lønnen din 1. januar hvert år basert på resultatet til Kynd. Vi passer
              på at lønna holder seg konkurransedyktig og tar også høyde for inflasjon.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Goder</h3>
            <ul>
              <li>Konkurransedyktig lønn</li>
              <li>Åpen økonomi</li>
              <li>Likeverdig eierskap</li>
              <li>Fleksible arbeidsforhold</li>
              <li>Kompetanseutvikling</li>
              <li>Moderne utstyr</li>
            </ul>
          </Prose>
        </PageSection>
      </section>

      <section id="arbeidsforhold">
        <PageSection heading="Arbeidsforhold">
          <Prose align="left">
            <p>
              Vi tror på tillit og fleksibilitet. Du kan jobbe der du er mest produktiv, enten det
              er på kontoret eller hjemmefra.
            </p>
            <p>
              Vi har ikke tradisjonelle arbeidstider, men forventer at du leverer kvalitet og er
              tilgjengelig når det trengs.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Arbeidssted</h3>
            <ul>
              <li>Hjemmekontor</li>
              <li>Kontor i Oslo</li>
              <li>Kundens lokaler</li>
              <li>Hybridløsninger</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Vi tror på tillit og fleksibilitet. Du kan jobbe der du er mest produktiv, enten det
              er på kontoret eller hjemmefra.
            </p>
            <p>
              Vi har ikke tradisjonelle arbeidstider, men forventer at du leverer kvalitet og er
              tilgjengelig når det trengs.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Arbeidssted</h3>
            <ul>
              <li>Hjemmekontor</li>
              <li>Kontor i Oslo</li>
              <li>Kundens lokaler</li>
              <li>Hybridløsninger</li>
            </ul>
          </Prose>
        </PageSection>
      </section>

      <section id="ferie-og-permisjon">
        <PageSection heading="Ferie og permisjon">
          <Prose align="left">
            <p>
              Du har rett på 25 feriedager per år. Vi oppfordrer til å ta ferie, og vi dekker
              feriepenger i henhold til loven.
            </p>
            <p>
              Ved sykdom eller andre behov for fravær, er vi fleksible og forståelsesfulle. Vi tror
              på at hvis vi gir deg tiden du trenger, vil du komme sterkere tilbake.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Permisjon</h3>
            <ul>
              <li>25 feriedager</li>
              <li>Feriepenger</li>
              <li>Sykefravær</li>
              <li>Foreldrepermisjon</li>
              <li>Utdanningspermisjon</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Du har rett på 25 feriedager per år. Vi oppfordrer til å ta ferie, og vi dekker
              feriepenger i henhold til loven.
            </p>
            <p>
              Ved sykdom eller andre behov for fravær, er vi fleksible og forståelsesfulle. Vi tror
              på at hvis vi gir deg tiden du trenger, vil du komme sterkere tilbake.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Permisjon</h3>
            <ul>
              <li>25 feriedager</li>
              <li>Feriepenger</li>
              <li>Sykefravær</li>
              <li>Foreldrepermisjon</li>
              <li>Utdanningspermisjon</li>
            </ul>
          </Prose>
        </PageSection>
      </section>

      <section id="kompetanseutvikling">
        <PageSection heading="Kompetanseutvikling">
          <Prose align="left">
            <p>
              Vi investerer tungt i kompetanseutvikling. Du får tid og ressurser til å lære nye
              teknologier og metoder.
            </p>
            <p>
              Vi deler kunnskap aktivt gjennom interne presentasjoner, workshops og konferansebesøk.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Muligheter</h3>
            <ul>
              <li>Konferansebesøk</li>
              <li>Kurs og sertifiseringer</li>
              <li>Interne workshops</li>
              <li>Mentoring</li>
              <li>Open source bidrag</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Vi investerer tungt i kompetanseutvikling. Du får tid og ressurser til å lære nye
              teknologier og metoder.
            </p>
            <p>
              Vi deler kunnskap aktivt gjennom interne presentasjoner, workshops og konferansebesøk.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Muligheter</h3>
            <ul>
              <li>Konferansebesøk</li>
              <li>Kurs og sertifiseringer</li>
              <li>Interne workshops</li>
              <li>Mentoring</li>
              <li>Open source bidrag</li>
            </ul>
          </Prose>
        </PageSection>
      </section>

      <section id="miljo-og-barekraft">
        <PageSection heading="Miljø og bærekraft">
          <Prose align="left">
            <p>
              Som selskap ønsker vi å ta ansvar og gjøre vår del for å begrense belastningen på
              miljøet og bli mer bærekraftige.
            </p>
            <p>
              Vi jobber aktivt med å redusere vår klimafotavtrykk og støtter bærekraftige løsninger
              i våre prosjekter.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Tiltak</h3>
            <ul>
              <li>Grønn teknologi</li>
              <li>Remote-first arbeid</li>
              <li>Bærekraftige leverandører</li>
              <li>Miljøvennlige kontorer</li>
              <li>Klimakompensasjon</li>
            </ul>
          </Prose>
          <Prose align="left">
            <p>
              Som selskap ønsker vi å ta ansvar og gjøre vår del for å begrense belastningen på
              miljøet og bli mer bærekraftige.
            </p>
            <p>
              Vi jobber aktivt med å redusere vår klimafotavtrykk og støtter bærekraftige løsninger
              i våre prosjekter.
            </p>
          </Prose>
          <Prose align="right">
            <h3>Tiltak</h3>
            <ul>
              <li>Grønn teknologi</li>
              <li>Remote-first arbeid</li>
              <li>Bærekraftige leverandører</li>
              <li>Miljøvennlige kontorer</li>
              <li>Klimakompensasjon</li>
            </ul>
          </Prose>
        </PageSection>
      </section>
    </div>
  </div>
</Layout>

<style>
  /* CSS Variables for Handbook */
  :root {
    --handbook-header-height: 4rem;
    --handbook-nav-height: 3rem;
    --handbook-nav-padding: 1rem;
    --handbook-z-index-nav: 15;
    --handbook-z-index-dropdown: 16;
    --handbook-z-index-toggle: 17;
    --handbook-transition-fast: background-color var(--animation-duration) ease;
    --handbook-transition-smooth: transform 0.3s ease;
    --handbook-gap-sm: 0.5rem;
    --handbook-gap-md: 2rem;
    --handbook-gap-lg: 4rem;
    --handbook-border-radius: 4px;
    --handbook-padding-sm: 0.75rem;
    --handbook-outline-width: 2px;
    --handbook-outline-offset: 2px;
    --handbook-triangle-size: 0.875rem;
    --handbook-desktop-nav-width: 250px;
    --handbook-shadow-blur: 6px;
    --handbook-rotation: 90deg;
    --handbook-focus-outline: var(--handbook-outline-width) solid var(--color-focus);
  }

  /* Mobile sticky navigation */
  .mobile-nav {
    display: block;
    position: sticky;
    top: var(--handbook-header-height);
    left: 0;
    right: 0;
    background-color: var(--color-background);
    border-bottom: 1px solid var(--color-border);
    z-index: var(--handbook-z-index-nav);
    padding: var(--handbook-gap-sm) 0;

    @media (--md) {
      display: none;
    }
  }

  .mobile-nav-content {
    display: flex;
    align-items: center;
    position: relative;
    gap: var(--handbook-gap-sm);
    cursor: pointer;
    padding-left: 0;
    outline: none;
    border-radius: var(--handbook-border-radius);
    transition: var(--handbook-transition-fast);

    &:focus {
      outline: var(--handbook-focus-outline);
      outline-offset: var(--handbook-outline-offset);
    }

    &:hover {
      background-color: var(--color-accent);
    }
  }

  .nav-title {
    font-size: var(--fs-body-s);
    font-weight: 600;
    margin: 0;
    color: var(--color-text);
  }

  .triangle-icon {
    font-size: var(--handbook-triangle-size);
    color: var(--color-text);
    transition: var(--handbook-transition-smooth);
    transform-origin: center;
  }

  .mobile-nav-content[aria-expanded='true'] .triangle-icon {
    transform: rotate(var(--handbook-rotation));
  }

  /* Dropdown menu */
  .handbook-dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-top: none;
    z-index: var(--handbook-z-index-dropdown);
    box-shadow: 0 4px var(--handbook-shadow-blur) -1px rgba(0, 0, 0, 0.1);

    &.open {
      display: block;
    }
  }

  /* Desktop navigation */
  .handbook-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--handbook-gap-md);
    max-width: var(--content-max-width);
    margin: 0 auto;

    @media (--md) {
      grid-template-columns: var(--handbook-desktop-nav-width) 1fr;
      gap: var(--handbook-gap-lg);
    }
  }

  .desktop-nav {
    display: none;
    position: sticky;
    top: calc(var(--handbook-header-height) + var(--handbook-nav-padding));
    height: fit-content;
    background-color: var(--color-background);
    padding: var(--handbook-nav-padding) 0;
    border-right: 1px solid var(--color-border);

    @media (--md) {
      display: block;
    }
  }

  .nav-menu {
    list-style: none;
    padding: 0;
    margin: 0;

    li {
      margin-bottom: 0;
    }

    a {
      display: block;
      padding: var(--handbook-padding-sm) var(--content-padding);
      text-decoration: none;
      color: var(--color-text);
      font-size: var(--fs-body-s);
      transition: var(--handbook-transition-fast);

      &:hover,
      &.active {
        background-color: var(--color-accent);
      }

      &:focus {
        outline: var(--handbook-focus-outline);
        outline-offset: var(--handbook-outline-offset);
      }

      &.active {
        font-weight: 600;
      }
    }
  }

  .handbook-content {
    padding-top: 0; /* No extra padding needed since nav is now sticky */

    @media (--md) {
      padding-top: 0;
    }
  }

  /* Smooth scrolling for anchor links */
  html {
    scroll-behavior: smooth;
  }

  /* Offset for sticky header */
  .handbook-content section[id] {
    scroll-margin-top: calc(
      var(--handbook-header-height) + var(--handbook-nav-height) + var(--handbook-nav-padding)
    );

    @media (--md) {
      scroll-margin-top: calc(var(--handbook-header-height) + 2rem);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const handbookMenuToggle = document.getElementById('handbook-menu-toggle');
    const handbookDropdown = document.getElementById('handbook-dropdown');
    const currentSection = document.getElementById('current-section');
    const navLinks = document.querySelectorAll('.nav-menu a');

    // Track current focused index for keyboard navigation
    let currentIndex = 0;

    // Section data for tracking
    const sections = [
      { id: 'om-kynd', title: 'Om Kynd' },
      { id: 'lonn-og-goder', title: 'Lønn og goder' },
      { id: 'arbeidsforhold', title: 'Arbeidsforhold' },
      { id: 'ferie-og-permisjon', title: 'Ferie og permisjon' },
      { id: 'kompetanseutvikling', title: 'Kompetanseutvikling' },
      { id: 'miljo-og-barekraft', title: 'Miljø og bærekraft' },
    ];

    // Toggle dropdown menu
    function toggleDropdown() {
      if (handbookMenuToggle && handbookDropdown) {
        const isExpanded = handbookMenuToggle.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
          handbookMenuToggle.setAttribute('aria-expanded', 'false');
          handbookDropdown.classList.remove('open');
          handbookMenuToggle.blur();
        } else {
          handbookMenuToggle.setAttribute('aria-expanded', 'true');
          handbookDropdown.classList.add('open');

          const allLinks = Array.from(
            handbookDropdown.querySelectorAll('a'),
          ) as HTMLAnchorElement[];
          if (allLinks.length > 0) {
            currentIndex = 0;
            allLinks[0]?.focus();
          }
        }
      }
    }

    // Close dropdown menu
    function closeDropdown() {
      if (handbookMenuToggle && handbookDropdown) {
        handbookMenuToggle.setAttribute('aria-expanded', 'false');
        handbookDropdown.classList.remove('open');
        handbookMenuToggle.blur();
      }
    }

    // Update current section based on scroll position
    function updateCurrentSection() {
      if (!currentSection) return;

      const scrollPosition = window.scrollY + 200;

      for (let i = sections.length - 1; i >= 0; i--) {
        const section = sections[i];
        if (!section) continue;

        const sectionElement = document.getElementById(section.id);
        if (sectionElement) {
          const elementTop = sectionElement.offsetTop;
          if (elementTop <= scrollPosition) {
            currentSection.textContent = section.title;
            updateActiveLink(section.id);
            break;
          }
        }
      }
    }

    // Update active link in navigation
    function updateActiveLink(activeId: string) {
      navLinks.forEach((link) => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${activeId}`) {
          link.classList.add('active');
        }
      });
    }

    // Event listeners
    if (handbookMenuToggle) {
      handbookMenuToggle.addEventListener('click', toggleDropdown);

      // Keyboard support
      handbookMenuToggle.addEventListener('keydown', function (event: KeyboardEvent) {
        if (event.key === 'Enter' || event.key === ' ') {
          if (event.target === handbookMenuToggle) {
            event.preventDefault();
            toggleDropdown();
          }
        } else if (
          event.key === 'ArrowDown' &&
          handbookDropdown &&
          handbookDropdown.classList.contains('open')
        ) {
          event.preventDefault();
          const firstLink = handbookDropdown.querySelector('a') as HTMLAnchorElement;
          if (firstLink) {
            firstLink.focus();
          }
        }
      });
    }

    // Global keyboard navigation for dropdown
    document.addEventListener('keydown', function (event: KeyboardEvent) {
      const isDropdownOpen = handbookDropdown?.classList.contains('open');
      const allLinks = Array.from(
        handbookDropdown?.querySelectorAll('a') || [],
      ) as HTMLAnchorElement[];

      if (!isDropdownOpen || allLinks.length === 0) return;

      if (event.key === 'ArrowDown') {
        event.preventDefault();
        currentIndex = (currentIndex + 1) % allLinks.length;
        allLinks[currentIndex]?.focus();
      } else if (event.key === 'ArrowUp') {
        event.preventDefault();
        currentIndex = (currentIndex - 1 + allLinks.length) % allLinks.length;
        allLinks[currentIndex]?.focus();
      } else if (event.key === 'Home') {
        event.preventDefault();
        currentIndex = 0;
        allLinks[currentIndex]?.focus();
      } else if (event.key === 'End') {
        event.preventDefault();
        currentIndex = allLinks.length - 1;
        allLinks[currentIndex]?.focus();
      } else if (event.key === 'Escape') {
        event.preventDefault();
        closeDropdown();
        if (handbookMenuToggle) {
          handbookMenuToggle.focus();
        }
      }
    });

    // Close dropdown when clicking on navigation links
    navLinks.forEach((link) => {
      link.addEventListener('click', function () {
        if (window.matchMedia('(max-width: 47.999em)').matches) {
          closeDropdown();
        }
      });

      // Handle Enter/Space on links
      link.addEventListener('keydown', function (event) {
        const keyboardEvent = event as KeyboardEvent;

        if (keyboardEvent.key === 'Enter' || keyboardEvent.key === ' ') {
          keyboardEvent.preventDefault();

          // Close the dropdown first
          if (window.matchMedia('(max-width: 47.999em)').matches) {
            closeDropdown();
          }

          // Then navigate to the target
          const href = link.getAttribute('href');
          if (href) {
            const targetElement = document.querySelector(href);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth' });
            }
          }
        }
      });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function (event) {
      if (handbookDropdown && handbookMenuToggle && event.target) {
        const target = event.target as Node;
        const isClickInsideDropdown = handbookDropdown.contains(target);
        const isClickOnToggle = handbookMenuToggle.contains(target);

        if (
          !isClickInsideDropdown &&
          !isClickOnToggle &&
          handbookDropdown.classList.contains('open')
        ) {
          closeDropdown();
        }
      }
    });

    // Scroll tracking
    let ticking = false;
    function handleScroll() {
      if (!ticking) {
        requestAnimationFrame(function () {
          updateCurrentSection();
          ticking = false;
        });
        ticking = true;
      }
    }

    window.addEventListener('scroll', handleScroll);

    // Initial call to set current section
    updateCurrentSection();

    // Handle window resize
    window.addEventListener('resize', function () {
      if (window.matchMedia('(min-width: 48em)').matches) {
        closeDropdown();
      }
    });
  });
</script>
